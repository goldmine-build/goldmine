# Our healhcheck response.
#
# Will match all requests that don't include a server_name, which is
# something only the healthchecks do, both GFE and readinessProbe.
server {
    listen 80;
    return 200 'ok';
}

#####   autoroll-internal.skia.org   ###########################
server {
    listen      80;
    server_name autoroll-internal.skia.org;
    rewrite ^ https://skia-autoroll.corp.goog redirect;
}

#####   status-internal.skia.org   ###########################
server {
    listen      80;
    server_name status-internal.skia.org;
    rewrite ^ https://skia-status.corp.goog redirect;
}

#####   skbug.com   ###########################
server {
    listen 80;
    server_name skbug.com;

    # Remove since we don't have a cert for skbug.com.
    add_header Strict-Transport-Security "";

    rewrite ^/([0-9]+)$ https://bugs.chromium.org/p/skia/issues/detail?id=$1 redirect;
    rewrite ^ https://bugs.chromium.org/p/skia/issues/list redirect;
}

#####   bug.skia.org   ###########################
server {
    listen 80;
    server_name bug.skia.org;

    # Note: nginx automatically appends the incoming query parameters to the redirect URL.
    rewrite ^/p/skia/issues/detail(/?)$ https://bugs.chromium.org/p/skia/issues/detail redirect;
    rewrite ^/p/skia/issues/list(/?)$ https://bugs.chromium.org/p/skia/issues/list redirect;
    rewrite ^/p/skia(.*) https://skia.org? redirect;
    rewrite ^/([0-9]+)$ https://bugs.chromium.org/p/skia/issues/detail?id=$1 redirect;
    rewrite ^ https://bugs.chromium.org/p/skia/issues/list redirect;
}

#####   bugs.skia.org   ##########################
# (People have trouble remembering if they should type "bug" or "bugs.")
server {
    listen 80;
    server_name bugs.skia.org;

    # Note: nginx automatically appends the incoming query parameters to the redirect URL.
    rewrite ^/p/skia/issues/detail(/?)$ https://bugs.chromium.org/p/skia/issues/detail redirect;
    rewrite ^/p/skia/issues/list(/?)$ https://bugs.chromium.org/p/skia/issues/list redirect;
    rewrite ^/p/skia(.*) https://skia.org? redirect;
    rewrite ^/([0-9]+)$ https://bugs.chromium.org/p/skia/issues/detail?id=$1 redirect;
    rewrite ^ https://bugs.chromium.org/p/skia/issues/list redirect;
}

#####   code.skia.org   ###########################
server {
    listen 80;

    server_name code.skia.org;
    rewrite ^ https://skia.googlesource.com/skia redirect;
}

#####   review.skia.org   ###########################
server {
    listen 80;
    server_name review.skia.org;

    # Note: nginx automatically appends the incoming query parameters to the redirect URL.
    rewrite ^/([0-9]+)$ https://skia-review.googlesource.com/c/$1/ redirect;
    rewrite ^ https://skia-review.googlesource.com redirect;
}

#####   reviews.skia.org   ##########################
# (People have trouble remembering if they should type "review" or "reviews.")
server {
    listen 80;
    server_name reviews.skia.org;

    # Note: nginx automatically appends the incoming query parameters to the redirect URL.
    rewrite ^/([0-9]+)$ https://skia-review.googlesource.com/c/$1/ redirect;
    rewrite ^ https://skia-review.googlesource.com redirect;
}


#####   cs.skia.org  ###########################
server {
    listen 80;
    server_name cs.skia.org;

    rewrite ^/(.+)$ https://code.google.com/p/chromium/codesearch#search/&q=$1%20file:%5Esrc/third_party/skia/&sq=package:chromium redirect;
    rewrite ^ https://code.google.com/p/chromium/codesearch#chromium/src/third_party/skia/ redirect;
}

#####   task-scheduler-internal.skia.org   ###########################
server {
    listen      80;
    server_name task-scheduler-internal.skia.org;

    rewrite ^ https://skia-task-scheduler.corp.goog redirect;
}

#####   fuzzer.skia.org   ###########################
server {
    listen      80;
    server_name fuzzer.skia.org;

    location / {
        return 301 https://bugs.chromium.org/p/oss-fuzz/issues/list?q=label:Proj-skia;
    }
}

#####   android-perf.skia.org   ###########################
server {
    listen 80;

    server_name android-perf.skia.org;

    rewrite ^ https://android-master-perf.skia.org redirect;
}
