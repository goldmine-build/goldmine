package main

import (
	"bytes"
	"strings"
	"testing"

	"github.com/stretchr/testify/require"
)

var input = `
arch,bench_type,2022-11-28T18:51:25.000Z,2022-11-28T19:05:31.000Z,2022-11-28T19:18:00.000Z,2022-11-28T20:29:50.000Z,2022-11-28T20:59:12.000Z,2022-11-28T22:03:47.000Z,2022-11-28T22:55:32.000Z,2022-11-29T00:52:00.000Z,2022-11-29T06:22:39.000Z,2022-11-29T06:28:21.000Z,2022-11-29T06:29:28.000Z,2022-11-29T06:41:30.000Z,2022-11-29T11:32:33.000Z,2022-11-29T14:26:08.000Z,2022-11-29T15:01:56.000Z,2022-11-29T15:08:45.000Z,2022-11-29T15:30:56.000Z,2022-11-29T15:41:07.000Z,2022-11-29T15:52:33.000Z,2022-11-29T16:58:23.000Z,2022-11-29T17:29:52.000Z,2022-11-29T17:54:16.000Z,2022-11-29T17:57:08.000Z,2022-11-29T18:35:39.000Z,2022-11-29T18:41:04.000Z,2022-11-29T20:50:30.000Z,2022-11-29T21:19:22.000Z,2022-11-29T21:21:06.000Z,2022-11-30T00:15:48.000Z,2022-11-30T04:38:12.000Z,2022-11-30T04:46:42.000Z,2022-11-30T05:05:54.000Z,2022-11-30T05:47:28.000Z,2022-11-30T12:54:18.000Z,2022-11-30T16:23:25.000Z,2022-11-30T16:23:59.000Z,2022-11-30T16:45:38.000Z,2022-11-30T17:06:26.000Z,2022-11-30T17:06:33.000Z,2022-11-30T17:27:54.000Z,2022-11-30T17:39:46.000Z,2022-11-30T19:06:16.000Z,2022-11-30T19:19:46.000Z,2022-11-30T21:26:09.000Z,2022-11-30T21:43:11.000Z,2022-11-30T22:07:30.000Z,2022-12-01T01:34:43.000Z,2022-12-01T03:57:40.000Z,2022-12-01T04:59:25.000Z,2022-12-01T05:05:42.000Z
arm,skandroidcodec,60.416927,60.232605,61.0913,60.95271,61.077133,62.6,60.42448,60.999844,60.976044,60.390102,60.76448,61.137447,60.567135,60.512604,60.40927,60.484634,60.620678,60.772186,60.311043,60.270885,60.625626,60.624947,60.413544,60.242813,60.78599,60.62771,61.621143,61.079845,61.56719,61.96875,60.437656,61.655624,61.117916,60.583855,60.291874,60.40078,60.501926,61.449165,60.10396,60.982292,60.55432,61.032032,60.448647,60.237602,60.30078,60.377968,61.046978,60.258957,61.926456,60.879585
arm,skandroidcodec,1.0018975,1.0089012,1.0073891,1.0022635,1.0076917,1.0018986,1.008417,1.0077485,1.0137981,1.0068436,1.0140622,1.0080625,1.0064185,1.0115016,1.0027857,1.0025188,1.0015508,1.0035926,1.0034328,1.0040106,1.0068246,1.0074579,1.0043985,1.003122,1.0033511,1.0078269,1.0111274,1.0033307,1.0074131,1.003103,1.0019519,1.0030555,1.008105,1.0018079,1.0151062,1.0030689,1.0036458,1.0063145,1.009682,1.0047367,1.0069213,1.0024935,1.0046544,1.0026536,1.0026957,1.0051309,1.0087398,1.0030165,1.0021708,1.0103517
`

var output = `arch,bench_type,2022-11-28,2022-11-29,2022-11-30,2022-12-01
arm,skandroidcodec,60.416927,60.999844,61.56719,61.046978
arm,skandroidcodec,1.0018975,1.0077485,1.0074131,1.0087398
`

func TestTransformCSV_HappyPath(t *testing.T) {
	inBuffer := strings.NewReader(input)
	var outBuffer bytes.Buffer

	err := transformCSV(inBuffer, &outBuffer)
	require.NoError(t, err)
	require.Equal(t, output, outBuffer.String())
}
